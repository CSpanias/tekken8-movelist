<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistics</title>
    <link rel="stylesheet" href="style.css">

    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Chart.js for graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .form-row label {
            flex: 1;
            min-width: 150px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        .edit-btn, .delete-btn {
            cursor: pointer;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            margin: 2px;
            color: white;
        }
        .edit-btn { background-color: blue; }
        .delete-btn { background-color: red; }
        .filter-box {
            margin: 10px 0;
        }
    </style>
</head>

<body class="page-theory-learning-plan">
    <div class="container">
        <nav>
            <a href="index.html">Home</a> |
            <a href="movelist.html">Movelist</a> |
            <a href="punishments.html">Punishments</a> |
            <a href="combos.html">Combos</a> |
            <a href="learning-plan.html">Learning Plan</a> |
            <a href="stats.html" class="active">Statistics</a> |
            <a href="drills.html">Drills</a> |
            <a href="rank-system.html">Rank System</a> |
            <a href="theory.html">Theory</a> |
            <a href="other.html">Other</a>
        </nav>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        function StatsTable() {
            const [data, setData] = React.useState(JSON.parse(localStorage.getItem("statsData")) || []);
            const [editIndex, setEditIndex] = React.useState(null);
            const [filterDate, setFilterDate] = React.useState("");

            React.useEffect(() => {
                updateChart();
            }, [data]);

            const handleNewData = (e) => {
                e.preventDefault();
                const newData = {
                    date: e.target.date.value,
                    goal: e.target.goal.value,
                    success: parseInt(e.target.success.value),
                    defended: parseInt(e.target.defended.value),
                    whiffed: parseInt(e.target.whiffed.value)
                };

                let updatedData = [...data];

                if (editIndex !== null) {
                    updatedData[editIndex] = newData;
                    setEditIndex(null);
                } else {
                    updatedData.push(newData);
                }

                setData(updatedData);
                localStorage.setItem("statsData", JSON.stringify(updatedData));
                e.target.reset();
            };

            const handleEdit = (index) => {
                const item = data[index];
                document.getElementById("date").value = item.date;
                document.getElementById("goal").value = item.goal;
                document.getElementById("success").value = item.success;
                document.getElementById("defended").value = item.defended;
                document.getElementById("whiffed").value = item.whiffed;
                setEditIndex(index);
            };

            const handleDelete = (index) => {
                const updatedData = data.filter((_, i) => i !== index);
                setData(updatedData);
                localStorage.setItem("statsData", JSON.stringify(updatedData));
            };

            const updateChart = () => {
                if (window.statsChart) {
                    window.statsChart.destroy();
                }

                const ctx = document.getElementById("statsChart").getContext("2d");
                const labels = data.map(item => item.date);
                const successData = data.map(item => item.success);
                const defendedData = data.map(item => item.defended);
                const whiffedData = data.map(item => item.whiffed);

                window.statsChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            { label: "Success", data: successData, backgroundColor: "green" },
                            { label: "Defended", data: defendedData, backgroundColor: "orange" },
                            { label: "Whiffed", data: whiffedData, backgroundColor: "red" }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            };

            return (
                <div>
                    <h1>Daily Stats Tracker</h1>
                    
                    <form onSubmit={handleNewData} className="form-row">
                        <label>Date: <input type="date" id="date" required /></label>
                        <label>Goal: <input type="text" id="goal" required /></label>
                        <label>Success: <input type="number" id="success" required /></label>
                        <label>Defended: <input type="number" id="defended" required /></label>
                        <label>Whiffed: <input type="number" id="whiffed" required /></label>
                        <button type="submit">{editIndex !== null ? "Update Data" : "Add Data"}</button>
                    </form>

                    <div className="filter-box">
                        <label>Filter by Date: <input type="date" onChange={(e) => setFilterDate(e.target.value)} /></label>
                    </div>

                    <h2>Statistics</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Goal</th>
                                <th>Success</th>
                                <th>Defended</th>
                                <th>Whiffed</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {data.filter(item => !filterDate || item.date === filterDate).map((item, index) => (
                                <tr key={index}>
                                    <td>{item.date}</td>
                                    <td>{item.goal}</td>
                                    <td>{item.success}</td>
                                    <td>{item.defended}</td>
                                    <td>{item.whiffed}</td>
                                    <td>
                                        <button className="edit-btn" onClick={() => handleEdit(index)}>Edit</button>
                                        <button className="delete-btn" onClick={() => handleDelete(index)}>Delete</button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>

                    <h2>Performance Chart</h2>
                    <canvas id="statsChart"></canvas>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById("root")).render(<StatsTable />);
    </script>
</body>
</html>
